2004-09-02  Kjartan Maraas  <kmaraas@gnome.org>

	* configure.in: Add «nb» to ALL_LINGUAS.

2004-09-01  Helvetix Victorinox  <helvetix@gimp.org>
 
	* Merged from HEAD:
	* app/composite/gimp-composite-*.[ch]
	* app/composite/make-installer.py: backported changes to composite
	  code from HEAD branch. Fixes bug #149429 and works around problems
	  with the Intel compiler (bug #147013).

2004-08-31  Michael Natterer  <mitch@gimp.org>

	Merged from HEAD:

	* app/paint/gimppaintoptions.[ch]: added "GimpPaintInfo *paint_info"
	member and construct property. Changed gimp_paint_options_new()
	to take only a GimpPaintInfo parameter.

	* app/core/gimpitem.c (gimp_item_stroke)
	* app/core/gimppaintinfo.c (gimp_paint_info_new): changed accordingly.

	* app/core/gimpchannel.c (gimp_channel_stroke)
	* app/vectors/gimpvectors.c (gimp_vectors_stroke): use
	paint_options->paint_info->paint_type directly instead of casting
	to GimpToolOptions and using
	tool_options->tool_info->paint_info->paint_type (eek). Fixes crash
	when stroking via the PDB because newly created GimpToolOptions
	instances have no "tool_info" pointer yet.

	* tools/pdbgen/pdb/paint_tools.pdb: changed all paint PDB wrappers
	accordingly.

	* app/pdb/paint_tools_cmds.c: regenerated.

2004-08-31  Michael Natterer  <mitch@gimp.org>

	Merged from HEAD:

	* app/config/gimpconfig.c (gimp_config_iface_duplicate): set
	construct_param->foo, not construct_param*s*->foo, so we don't set
	the first construct param again and crash.

2004-08-29  Sven Neumann  <sven@gimp.org>

	Merged from HEAD:

	* app/config/gimpconfigwriter.c: don't emit critical warnings
        about a messed up state of GimpConfigWriter if the writer is
        disabled because of a write error that occured earlier.

2004-08-28  Sven Neumann  <sven@gimp.org>

	Merged from HEAD:

	* plug-ins/common/vpropagate.c (run): fixed confusion about which
	mode to use when being run with last values (bug #151308).

2004-08-28  Sven Neumann  <sven@gimp.org>

	Merged from HEAD:

	* app/core/gimpimage-contiguous-region.c
	(find_contiguous_region_helper): applied a patch from Eric Cheung
	that changes the function to use a GQueue to implement recursion
	instead of recursive function calls. Fixes bug #151124.

2004-08-26  Michael Natterer  <mitch@gimp.org>

	Merged from HEAD:

	* app/core/gimpitem.c (gimp_item_stroke): implement the whole
	paint_options fiddling here instead of in each subclass and pass
	either GimpStrokeOptions or GimpPaintOptions (instead of
	GimpStrokeOptions or GimpPaintInfo) to GimpItem::stroke().

	Also copied code from the tool_manager which makes sure we really
	use the global brush, pattern etc. if these options are checked in
	prefs. Fixes bug #150716.

	* app/core/gimpchannel.c (gimp_channel_stroke)
	* app/vectors/gimpvectors.c (gimp_vectors_stroke): removed the
	duplicated code mentioned above and simply use the paint_options
	passed.

	* app/core/gimpitem.[ch]: removed "gboolean use_default_values"
	from GimpItem::stroke().

	* app/core/gimpchannel.c
	* app/core/gimpselection.c
	* app/vectors/gimpvectors.c: changed accordingly.

22004-08-26  Sven Neumann  <sven@gimp.org>

	* app/sanity.c (sanity_check_filename_encoding): try to convert
	the result of gimp_directory() to UTF-8 and bail out with a
	moderately helpful error message if this conversion fails. Works
	around bug #150917.

2004-08-25  Manish Singh  <yosh@gimp.org>

	* plug-ins/common/gifload.c: Guard against bogus logical screen
	dimensions. Fixes bug #151053.

2004-08-22  Sven Neumann  <sven@gimp.org>

	* app/vectors/gimpvectors-import.c (parse_svg_transform): merged
	fixes from HEAD branch.

2004-08-20  Sven Neumann  <sven@gimp.org>

	* plug-ins/common/gif.c: declared global const variable as static.
	Fixes compiler warnings seen with gcc 3.4.1. Merged from HEAD.

2004-08-16  Sven Neumann  <sven@gimp.org>

	* app/widgets/gimpcolorframe.c (gimp_color_frame_update): fixed
	labels in CMYK mode. Fixes bug #150213.

2004-08-15  Sven Neumann  <sven@gimp.org>

	* app/widgets/gimpdevicestatus.c: removed non-functional button
	labelled "Configure input devices". Fixes bug #150177 for the
	stable branch.

2004-08-09  Michael Natterer  <mitch@gimp.org>

	Merged from HEAD:

	* app/tools/gimpsheartool.[ch]: applied (modified) patch from Ari
	Pollak which enables controlling the shear direction from the
	dialog and changing the shear direction without hitting "Reset".
	Fixes bug #149467.

2004-08-09  Sven Neumann  <sven@gimp.org>

	* plug-ins/common/postscript.c (save_ps_header): use the basename
	as Title, not the full filename. Fixes bug #149669; merged from HEAD.

2004-08-07  Sven Neumann  <sven@gimp.org>

	* configure.in: bumped version number to 2.0.5, interface_age 5,
	binary_age 5.

	* app/sanity.c: abort if the configured filename encoding can't be
	converted to UTF-8. Fix for bug #149464, merged from HEAD branch.

2004-08-05  Sven Neumann  <sven@gimp.org>

	* Made 2.0.4, the 'GIMP Tipsy' release.

2004-08-05  Sven Neumann  <sven@gimp.org>

	* app/app_procs.c
	* app/base/base.[ch]
	* app/composite/Makefile.am
	* app/composite/gimp-composite-3dnow-test.c
	* app/composite/gimp-composite-3dnow.[ch]
	* app/composite/gimp-composite-altivec-test.c
	* app/composite/gimp-composite-altivec.[ch]
	* app/composite/gimp-composite-mmx-installer.c
	* app/composite/gimp-composite-mmx-test.c
	* app/composite/gimp-composite-mmx.[ch]
	* app/composite/gimp-composite-sse-installer.c
	* app/composite/gimp-composite-sse-test.c
	* app/composite/gimp-composite-sse.[ch]
	* app/composite/gimp-composite-sse2-installer.c
	* app/composite/gimp-composite-sse2-test.c
	* app/composite/gimp-composite-sse2.[ch]
	* app/composite/gimp-composite-vis-test.c
	* app/composite/gimp-composite-vis.[ch]
	* app/composite/gimp-composite-x86.h
	* app/composite/gimp-composite.[ch]
	* app/composite/make-installer.py: backported changes to composite
	code from HEAD branch. Fixes bug #149429 and works around problems
	with the Intel compiler (bug #147013).

2004-08-05  Michael Natterer  <mitch@gimp.org>

	Merged from HEAD:

	* app/tools/gimpiscissorstool.c: increased the handle size from 8
	to 9 pixels (which is the same as in the path tool) as suggested
	in bug #134250.

2004-08-04  Michael Natterer  <mitch@gimp.org>

	Merged from HEAD:

	Allow URI drops from apps linked against GLib < 2.4.4 to GIMP
	linked against GLib >= 2.4.5. Fixes bug #148140.

	* app/core/gimp-utils.[ch]: added gimp_check_glib_version().

	* app/widgets/gimpdnd.c: added runtime check for GLib versions
	that encode file:// URIs correctly (>= 2.4.5). For older
	(broken) GLibs, leave the code path as is, for newer (fixed) ones,
	perform an additional check if the dropped URI is in the (broken)
	escaped-UTF-8 format and convert it to local filename encoding.

	* app/gui/gui.c: warn the user that non-ASCII filenames can't
	be used when linked against GLib 2.4.4.

2004-08-03  Michael Natterer  <mitch@gimp.org>

	Merged from HEAD:

	* app/widgets/gimpcontainergridview.c
	(gimp_container_grid_view_item_context): ref/unref the view around
	the calls to gimp_container_view_item_selected() and _item_context()
	because the former may destroy the view which leads to a crash
	when trying the latter. Fixes bug #148955.

2004-08-03  Michael Natterer  <mitch@gimp.org>

	* app/tools/gimpeditselectiontool.c
	* app/tools/gimptexttool.c
	* app/widgets/gimpitemtreeview.c
	* app/widgets/gimplayertreeview.c: don't compress undos if the
	image is clean. Fixes bug #148853.

2004-07-30  Sven Neumann  <sven@gimp.org>

	Applied a bunch of small changes contributed by Tim Mooney to fix
	stack corruption on Tru64 and Aix (bug #129867).

	* app/Makefile.am
	* plug-ins/script-fu/Makefile.am: changed the dependency order so
	that $(REGEXREPL) is linked earlier.

	* regexrepl/regex.[ch]: fixed check for __STDC__, merged upstream
	fix for re_max_failures value.

2004-07-30  Sven Neumann  <sven@gimp.org>

	* configure.in: always do the check for perl and use the
	substituted perl executable name in the call for gimp-mkenums.
	Fixes the build on platforms where perl is not available as
	/usr/bin/perl. Closes bug #148813.

2004-07-30  Sven Neumann  <sven@gimp.org>

	Applied a bunch of AIX portability fixes (bug #148813):

	* configure.in: when testing for Xmu library, link with -lXt -lX11.

	* app/gui/tips-parser.c
	* app/gui/user-install-dialog.c
	* app/tools/tools-enums.h
	* app/widgets/gimpdasheditor.c
	* app/widgets/widgets-enums.h
	* libgimpthumb/gimpthumb-error.h
	* libgimpwidgets/gimpcolorbutton.c
	* plug-ins/common/edge.c: removed trailing commas from enums.

	* plug-ins/common/snoise.c: renamed defines to avoid collision
	with system headers.

	* plug-ins/imagemap/imap_cmd_move.c: no C++ style comments.

	* app/paint-funcs/paint-funcs-generic.h
	* app/paint-funcs/paint-funcs.c: use integers for bit fields.

2004-07-29  Dave Neary  <bolsh@gimp.org>

	* app/core/gimpdrawable-transform.c: Stop signed ints overflowing 
	while getting the mean by replacing (a + b) / 2 with a / 2 + b / 2. 
	Fixes bug #128594 for drawables less than 32K wide.

2004-07-29  Sven Neumann  <sven@gimp.org>

	* plug-ins/script-fu/script-fu-scripts.c (script_fu_free_script):
	applied patch by Kevin Cozens that moves a g_free() to the right
	place (bug #148729, merged from HEAD).

2004-07-28  Bill Skaggs  <weskaggs@primate.ucdavis.edu>

	* plug-ins/common/jpeg.c: changed "exif-data" back to 
	"jpeg-exif-data" to fix bug #148632.
	
2004-07-28  Michael Natterer  <mitch@gimp.org>

	Merged from HEAD (fixes bug #148614, backported by Pedro Gimeno):

	* app/core/gimpimage.c (gimp_image_finalize): remove the image
	from the image hash table and set its "gimp" pointer to NULL
	*after* all layers, channels, vectors and the selection are
	finalized; otherwise these items have no chance of removing
	themselves from the item hash table (because image->gimp is
	already NULL).

2004-07-27  Sven Neumann  <sven@gimp.org>

	* app/widgets/gimphelp.c (gimp_help): print the help-id and
	help-domain to stdout if gimp was started with the --verbose
	command-line option.

2004-07-26  Sven Neumann  <sven@gimp.org>

	* plug-ins/bmp/bmp.h
	* plug-ins/bmp/bmpread.c: merged patch by Brion Vibber from HEAD
	branch. Fixes extra data overflow, nonstandard 16bpp field
	arrangement and unrecognized compression (bug #143682).

2004-07-24  Pedro Gimeno  <pggimeno@wanadoo.es>

	* app/gui/gradient-editor-menu.c (gradient_editor_menu_update):
	Fix typo which caused warnings when Sinusoidal blending mode was
	selected for a segment. Fixes bug #148300.

2004-07-22  Michael Natterer  <mitch@gimp.org>

	Merged from HEAD:

	* tools/gimp-remote.c (main): correctly convert relative paths to
	URIs. Append the resulting URI only if it's not NULL.

2004-07-19  Sven Neumann  <sven@gimp.org>

	* configure.in: bumped version number to 2.0.4, interface_age 4,
	binary_age 4.

2004-07-19  Sven Neumann  <sven@gimp.org>

	* app/core/gimpdrawable-combine.c (gimp_channel_combine_ellipse):
	backported improvements to the anti-aliasing for
        elliptical selections from HEAD branch (bug #147836).

2004-07-18  Philip Lafleur  <plafleur@cvs.gnome.org>

	* app/tools/gimpinktool-blob.c (blob_make_convex): Check if the
	array index is legal before using it, not the other way around.
	Fixes bug #144856, merged from HEAD.

2004-07-17  Philip Lafleur  <plafleur@cvs.gnome.org>

	* plug-ins/common/polar.c (dialog_update_preview): Fixed a
	write to unallocated memory that was causing crashes in various
	spots. Merged from HEAD.

2004-07-17  Philip Lafleur  <plafleur@cvs.gnome.org>

	* plug-ins/common/polar.c (polarize_func): moved array
	initialization out of variable declaration. Fixes bug #147799,
	merged from HEAD.

2004-07-17  Sven Neumann  <sven@gimp.org>

	* Made 2.0.3 release.

2004-07-17  Philip Lafleur  <plafleur@cvs.gnome.org>

	* plug-ins/bmp/bmpwrite.c (WriteImage): Applied a patch from
	Brion Vibber that fixes corruption when saving RLE-encoded
	BMPs on big endian hosts. Fixes bug #147759, merged from HEAD.

2004-07-17  Sven Neumann  <sven@gimp.org>

	* NEWS: updated for 2.0.3 release.

2004-07-14  Philip Lafleur  <plafleur@cvs.gnome.org>

	* plug-ins/common/png.c:
	* plug-ins/common/mng.c: Fixed erroneously reported warning
	message when saving indexed layers with an alpha channel but
	no transparent pixels. Merged from HEAD.

2004-07-14  Sven Neumann  <sven@gimp.org>

	* plug-ins/script-fu/script-fu-console.[ch]
	* plug-ins/script-fu/script-fu.c
	* plug-ins/script-fu/siod-wrapper.[ch]
	* plug-ins/script-fu/siod/slib.c: merged fix for bug #139200
	(script-fu console freezes on long output from SIOD interpreter).

2004-07-14  Philip Lafleur  <plafleur@cvs.gnome.org>

	* plug-ins/common/mng.c (respin_cmap): Properly check the return
	value of find_unused_ia_color(). The plugin will now save indexed
	MNGs correctly; fixes bug #139947, merged from HEAD.

2004-07-14  Sven Neumann  <sven@gimp.org>

	* plug-ins/common/tiff.c: merged fix for bug #147328 from HEAD
	branch. Fixes loading of CMYK TIFF images on big-endian hardware.

2004-07-13  Sven Neumann  <sven@gimp.org>

	* app/text/gimptextundo.c (gimp_text_undo_get_memsize): merged
	some code from the HEAD branch that improves the computation of
	the memory requirements for a text undo step.

2004-07-13  Sven Neumann  <sven@gimp.org>

	* plug-ins/common/jpeg.c: merged fix for bug #145212 (JPEG plug-in
	crashes on corrupt EXIF data) from HEAD branch.

2004-07-13  Sven Neumann  <sven@gimp.org>

	* app/tools/gimptexttool.c (gimp_text_tool_create_layer): plugged
	a tiny memory leak.

2004-07-12  Sven Neumann  <sven@gimp.org>

	Backported the missing gimp-path-get-point-at-dist PDB function
	from the HEAD branch (bug #138754):

	* app/vectors/gimpstroke.[ch]: added gimp_stroke_get_point_at_dist().

	* tools/pdbgen/pdb/paths.pdb: use the new API to implement
	gimp-path-get-point-at-dist.

	* app/pdb/paths_cmds.c: regenerated.

2004-07-12  Michael Natterer  <mitch@gimp.org>

	Merged from HEAD:

	* plug-ins/script-fu/scripts/round-corners.scm: applied patch from
	Dave Neary that changes the behavior from undo disable/enable to
	using an undo group if the script doesn't work on a copy of the
	image. Fixes bug #146344.

2004-07-12  Sven Neumann  <sven@gimp.org>

	* plug-ins/common/tiff.c: applied a patch from Brion Vibber that
	sets the 'Save color values from transparent pixels' insensitive
	when there's no alpha channel. Merged from HEAD branch.

2004-07-11  Philip Lafleur  <plafleur@cvs.gnome.org>

	* app/widgets/gimpdevices.c (gimp_devices_check_change):
	Applied a patch from Robert Ögren, moved here from
	toolbox_check_device() - Only change devices if the event came
	from a widget that accepts extension events.
	Fixes bug #115774, merged from HEAD.

2004-07-07  Michael Natterer  <mitch@gimp.org>

	Merged from HEAD:

	Made the undo system robust against the currently pushed undo
	being too large according to prefs settings. Fixes bug #145379.

	* app/core/gimpimage-undo.[ch] (gimp_image_undo_push_undo)
	(gimp_image_undo_group_end): emit "undo-event" *before* calling
	gimp_image_undo_free_space() so the undo history doesn't try to
	remove an item that has never been added.

	(gimp_image_undo_push_undo): added boolean return value indicating
	if the undo could be pushed (FALSE means the undo was to large
	and was discarded right away).

	(gimp_image_undo_push_item): return NULL if the above returned
	FALSE.

	* app/core/gimpimage-undo-push.c (gimp_image_undo_push_text_layer):
	changed accordingly.

2004-07-05  Michael Natterer  <mitch@gimp.org>

	Merged from HEAD:

	* app/tools/gimpcolorizetool.c (gimp_colorize_tool_initialize):
	return TRUE if initialization was successful. Makes the
	tool->drawable pointer being set correctly by the calling code and
	fixes bugs where colorize was leaving the drawable in a modified
	but non-undoable state when cancelling or changing images.

2004-07-05  Michael Natterer  <mitch@gimp.org>

	* app/core/gimpcontext.c (gimp_context_serialize_property):
	disabled code that was accidentially enabled and broke persistence
	of many tool options settings and of the context part of devicerc.

2004-07-04  Sven Neumann  <sven@gimp.org>

	* plug-ins/common/channel_mixer.c: don't attempt to store a
	pointer to the last used filename in the plug-in parameter
	struct. Fixes bug #145380; merged from HEAD branch.

2004-07-01  Michael Schumacher  <schumaml@cvs.gnome.org>

	* plug-ins/common/align_layers.c: there seems to be no reason why
	this plug-in should not work on INDEXED* images, added it to the
	registered image types

2004-06-28  Sven Neumann  <sven@gimp.org>

	* configure.in: bumped version number to 2.0.3, interface_age 3,
	binary_age 3.

2004-06-28  Michael Natterer  <mitch@gimp.org>

	Merged from HEAD:

	Fixed bug #141930 while keeping bug #132322 fixed:

	* app/base/curves.c (curves_lut_func)
	* app/base/levels.c (levels_lut_func): changed meaning of channel
	slots for GRAYA images: just as for GRAY images, expect the value
	channel in slot 0 and the alpha channel in slot 1, so it matches
	the meaning of slots of GimpHistogram (before this change, only
	GRAY images had their value in slot 0 and GRAYA images had it in
	slot 1, whereas the histogram had the value channel in slot 0,
	which was breaking auto levels for GRAYA images).

	* app/tools/gimpcurvestool.c
	* app/tools/gimplevelstool.c
	* tools/pdbgen/pdb/color.pdb: adjusted channel fiddling for GRAY
	and GRAYA images accordingly.

	* app/tools/gimpcurvestool.c (curves_update)
	* app/tools/gimplevelstool.c (levels_update): call
	gimp_color_bar_set_buffers() with the right buffers.

	* app/pdb/color_cmds.c: regenerated.
2004-06-22  Sven Neumann  <sven@gimp.org>

	* app/composite/gimp-composite-regression.c: define timersub()
	macro in case it's undefined. Patch by Tim Mooney, fixes 'make
	check' on Tru64 (bug #144780). Merged from HEAD branch.

2004-06-22  Sven Neumann  <sven@gimp.org>

	* libgimpwidgets/gimpcolorarea.c (gimp_color_area_set_color): use
	gimp_rgb_distance() for flat color areas. Fixes bug #144786;
	merged from HEAD.

2004-06-19  Pedro Gimeno  <pggimeno@wanadoo.es>

	* tools/pdbgen/pdb/paths.pdb: Fix typos and improve documentation.
	Merged from HEAD. Addresses bug #144267.

	* app/pdb/paths_cmds.c
	* libgimp/gimppaths_pdb.c: regenerated.

2004-06-19  Sven Neumann  <sven@gimp.org>

	* app/vectors/gimpbezierstroke.c (arcto_ellipsesegment): moved
	array initialization out of variable declaration (bug #144632).

2004-06-19  Sven Neumann  <sven@gimp.org>

	* app/vectors/gimpbezierstroke.c (arcto_ellipsesegment): use
	G_SQRT2 to make circlemagic a constant value so we can initialize
	the array on declaration. Fixes bug #144632; merged from HEAD.

2004-06-18  Philip Lafleur  <plafleur@cvs.gnome.org>

	* app/tools/gimptransformtool.c: reverted my previous change.

2004-06-18  Philip Lafleur  <plafleur@cvs.gnome.org>

	* app/tools/gimptransformtool.c (gimp_transform_tool_bounds):
	If transforming a path, use the path bounds rather than the mask
	bounds. Fixes bug #144570. Merged from HEAD.

2004-06-15  Sven Neumann  <sven@gimp.org>

	* Made 2.0.2 release.

2004-06-15  Philip Lafleur  <plafleur@cvs.gnome.org>

	* app/core/gimpdrawable-transform.c
	(gimp_drawable_transform_tiles_affine): Don't round texture
	coordinates when not using interpolation. Fixes bug #144352 for
	the nearest neighbor case only. Merged from HEAD.

2004-06-15  Sven Neumann  <sven@gimp.org>

	* plug-ins/common/mng.c (respin_cmap): applied the fix for empty
	colormaps (bug #143009) here as well. Merged from HEAD branch.

2004-06-15  Sven Neumann  <sven@gimp.org>

	* configure.in: bumped version number to 2.0.2, interface_age 2,
	binary_age 2.

2004-06-14  Henrik Brix Andersen  <brix@gimp.org>

	* app/plug-in/plug-in-run.c: let extensions run synchronously when
	called via PDB. Fixes bug #140112. Merged from HEAD.

2004-06-13  Manish Singh  <yosh@gimp.org>

	* configure.in: Make sure PangoFT2 is using a recent enough fontconfig
	since many people have broken and confused setups.

2004-06-13  Manish Singh  <yosh@gimp.org>

	* app/base/cpu-accel.c: Reorged, to address bug #142907 and
	bug #143069. Accel implementations #define HAVE_ACCEL, and cpu_accel()
	keys on that. Both PPC and X86 implementations check for __GNUC__.
	X86 stuff is only used with USE_MMX is defined. The SSE OS check
	is now checked in arch_accel(), not cpu_accel(). Finally, the
	arch x86_64 checks now are EM64T aware (which didn't matter in
	practice).

2004-06-07  Michael Natterer  <mitch@gimp.org>

	Merged from HEAD:

	* app/core/gimplayer.c (gimp_layer_set_tiles): don't set
	layer->mask's offsets. It is wrong because GimpDrawable::set_tiles()
	is a lowlevel function which is used by stuff like scale and
	resize which keep the mask in sync explicitely and don't expect it
	to be moved in the middle of chaining up. Fixes bug #143860.

2004-06-07  Sven Neumann  <sven@gimp.org>

	* plug-ins/common/blur.c: fixed typo that caused corruption of
	first row. Spotted by William Skaggs, bug #142318.

2004-06-05  Sven Neumann  <sven@gimp.org>

	* plug-ins/common/curve_bend.c: applied a patch from Henrik Brix
	Andersen that tells the user that Curve Bend cannot operate on
	layers with masks instead of silently applying the mask
	(bug #134748).

2004-06-05  Sven Neumann  <sven@gimp.org>

	* plug-ins/sgi/sgi.c: merged a patch from Philip Lafleur that
	makes the plug-in handle images with more than 4 channels. At the
	moment the extra information is discarded (bug #143673).

2004-06-05  Sven Neumann  <sven@gimp.org>

	* plug-ins/common/tiff.c: save the proper value for type of alpha
	channel. Fixes bug #143522; patch by Philip Lafleur merged from
	HEAD branch.

2004-06-05  Sven Neumann  <sven@gimp.org>

	* app/text/gimptext-bitmap.c (gimp_text_render_bitmap): removed a
	redundant transformation (merged from HEAD branch).

2004-06-04  Sven Neumann  <sven@gimp.org>

	* app/widgets/gimptexteditor.c (gimp_text_editor_new): set the
	focus on the text area (merged from HEAD branch).

2004-06-04  Sven Neumann  <sven@gimp.org>

	* app/tools/gimptexttool.c (gimp_text_tool_class_init): allow to
	move a text layer using the cursor keys (merged from HEAD branch).

2004-06-04  Sven Neumann  <sven@gimp.org>

	* app/paint/gimppaintoptions.c (DEFAULT_PRESSURE_PRESSURE):
	applied a patch by Philip Lafleur that changes the default to
	FALSE. Fixes bug #143626; merged from HEAD branch.

2004-06-02  Sven Neumann  <sven@gimp.org>

	* INSTALL: suggest to use gimp-print 4.2.7-pre1 in case of problems
	(see bug #138273).

2004-06-01  Sven Neumann  <sven@gimp.org>

	* plug-ins/common/tiff.c: don't call gtk_entry_set_text() with a
	NULL text. Merged from HEAD branch.

2004-05-29  Sven Neumann  <sven@gimp.org>

	* app/widgets/gimpfiledialog.[ch]: reset the file type menu to "By
	Extension". Based on a patch from Philip Lafleur (bug #141535).

2004-05-29  Sven Neumann  <sven@gimp.org>

	* tools/pdbgen/pdb/layer.pdb
	* app/pdb/layer_cmds.c
	* libgimp/gimplayer_pdb.c: fixed documentation for gimp_resize_layer.
	Patch provided by Philip Lafleur (bug #142618, merged from HEAD).

2004-05-27  Sven Neumann  <sven@gimp.org>

	* plug-ins/common/png.c (respin_cmap): handle an empty colormap.
	Fixes bug #143009, merged from HEAD branch.

2004-05-27  Sven Neumann  <sven@gimp.org>

	* libgimpwidgets/gimppickbutton.c: applied patch from Philip
	Lafleur that fixes color picking for XInput devices (bug #143166).

2004-05-27  Sven Neumann  <sven@gimp.org>

	* app/display/gimpdisplayshell-draw.c
	(gimp_display_shell_draw_grid): fixed handling of grid offsets in
	the grid drawing routine. Merged from HEAD.

2004-05-26  Sven Neumann  <sven@gimp.org>

	* plug-ins/script-fu/scripts/Makefile.am: do not install
	test-sphere.scm in the stable branch.

2004-05-24  Sven Neumann  <sven@gimp.org>

	* plug-ins/common/mblur.c: fixed range check of blur type
	parameter (bug #142965, merged from HEAD branch).

2004-05-24  Sven Neumann  <sven@gimp.org>

	Applied a patch from Philip Lafleur (bug #142808):

	* app/paint/gimppaintcore.h: define PRESSURE_SCALE to 1.5

	* app/paint/gimpairbrush.c
	* app/paint/gimpclone.c
	* app/paint/gimpconvolve.c
	* app/paint/gimpdodgeburn.c
	* app/paint/gimperaser.c
	* app/paint/gimppaintbrush.c
	* app/paint/gimpsmudge.c: use the PRESSURE_SCALE constant.

2004-05-24  Sven Neumann  <sven@gimp.org>

	* configure.in: added "lt" (Lithuanian) to ALL_LINGUAS.

2004-05-23  Sven Neumann  <sven@gimp.org>

	More fixes for bug #142996, merged from HEAD branch:

	* plug-ins/common/postscript.c
	* plug-ins/common/sparkle.c
	* plug-ins/common/sunras.c
	* plug-ins/common/uniteditor.c
	* plug-ins/fits/fits.c: fixed typos.

2004-05-23  Sven Neumann  <sven@gimp.org>

	Fixes for bug #142996, merged from HEAD branch:
	
	* app/gui/preferences-dialog.c: added missing gettext call. 

	* app/config/gimprc-blurbs.h
	* app/core/gimptemplate.c
	* app/gui/gradient-editor-menu.c: fixed typos.

2004-05-23  Henrik Brix Andersen  <brix@gimp.org>

	* app/config/gimprc-blurbs.h
	* plug-ins/gfig/gfig-spiral.c (spiral_button_press)
	* plug-ins/gimpressionist/orientation.c (create_orientationpage)
	* plug-ins/common/diffraction.c (diffraction_dialog)
	* plug-ins/common/bumpmap.c (bumpmap_dialog)
	* plug-ins/maze/maze.h
	* plug-ins/MapObject/mapobject_apply.c (compute_image)
	* app/tools/gimpmeasuretool.c (gimp_measure_tool_dialog_update)
	* plug-ins/print/gimp_main_window.c (create_scaling_frame): marked
	strings for translation, corrected small typos. Fixes part of bug
	#142996, merged from HEAD branch.

2004-05-21  Sven Neumann  <sven@gimp.org>

	* app/paint/gimppaintcore.c (gimp_paint_core_interpolate): better
	fix for bug #123811, merged from HEAD branch.

2004-05-21  Michael Natterer  <mitch@gimp.org>

	* app/widgets/gimpdatafactoryview.c
	(gimp_data_factory_view_delete_callback): delete the data
	only if "OK" was pressed.

2004-05-19  Manish Singh  <yosh@gimp.org>

	* plug-ins/pygimp/gimpfu.py: Actually return values from the run
	function. Fixes #141338.

2004-05-19  Sven Neumann  <sven@gimp.org>

	* app/paint/gimppaintcore.c (gimp_paint_core_interpolate): make
	sure that pressure never becomes negative. Fix for bug #123811,
	merged from HEAD branch.

2004-05-16  Sven Neumann  <sven@gimp.org>

	* plug-ins/script-fu/scripts/old-photo.scm: fixed wrong use of
	layer ID; bug #142326, merged from HEAD.

2004-05-15  Sven Neumann  <sven@gimp.org>

	* app/tools/gimpcurvestool.c: fixed position of vertical line
	indicating the picked color. Patch from William Skaggs and
	Søren Wedel Nielsen, merged from HEAD branch. Fixes bug #142506.

2004-05-11  Sven Neumann  <sven@gimp.org>

	* docs/gimptool.1.in: fixed spelling, merge from HEAD.

2004-05-10  Sven Neumann  <sven@gimp.org>

	* app/xcf/xcf-save.c (xcf_save_prop): fixed size of colormap
	property. Fixes bug #142149; merged from HEAD branch.

2004-05-10  Sven Neumann  <sven@gimp.org>

	* app/widgets/gimptexteditor.c (gimp_text_editor_set_direction):
	don't call gtk_widget_set_direction() on a non-existant widget.
	Fix for bug #141792, merged from HEAD branch.

2004-05-09  Hans Breuer  <hans@breuer.org>

	* app/makefile.msc : $(FONTCONFIG_CFLAGS)
	  app/composite/makefile.msc : don't build dll
	  app/modules/makefile.msc : ../app/gimp.lib is gone
	  plug-ins/makefile.msc : somehow the script-fu icon got lost
	  themes/default/images/makefile.msc : removed a bunch
	of stock images which are not used anymore.
	In general : make the whole build process work more out 
	of the box ;-)

	* plug-ins/common/winclipboard.c : support gray images;
	fixes bug #141382

	* plug-ins/common/winprint.c : dito; fixes bug #141145

2004-05-06  Manish Singh  <yosh@gimp.org>

	* tools/pdbgen/pdb/paint_tools.pdb: Fix silly "Dodgebure" typo.

2004-05-06  Sven Neumann  <sven@gimp.org>

	* app/core/gimpdrawable-preview.c
	* app/core/gimpimage-projection.c: added sanity so we don't just
	plain crash when an indexed image doesn't have a colormap.

	* plug-ins/common/png.c: keep at least one entry in the colormap.
	Fixes bug #142029.

2004-05-06  Sven Neumann  <sven@gimp.org>

	* app/gui/about-dialog.c: center the about dialog on the monitor,
	not on the screen. Fix for xinerama setups merged from HEAD branch.

2004-05-04  Michael Natterer  <mitch@gimp.org>

	Fix bug #141719 (merged from HEAD):

	* app/tools/gimpmovetool.c (gimp_move_tool_motion): use RINT()
	instead of ROUND() to round double coords to guide positions.

	* app/display/gimpdisplayshell-callbacks.c
	(gimp_display_shell_canvas_tool_events): pass RINT()-rounded
	coords to gimp_display_shell_update_cursor() instead of implicitly
	truncating by casting to int.

2004-04-30  Pedro Gimeno  <pggimeno@wanadoo.es>

	* app/tools/gimprectselecttool.c: Cleanups.
	(gimp_rect_select_tool_coords_to_integer): Undo my bogus fix for
	bug #138103, which led to bug #140649.

	* app/pdb/procedural_db.c (procedural_db_init_procs): Add missing
	compat procs: gimp_channel_ops_duplicate, gimp_channel_ops_offset.

2004-04-29  Manish Singh  <yosh@gimp.org>

	* plug-ins/pygimp/plug-ins/py-slice.py: Quick fix to make uppercase
	tags work properly.

2004-04-20  Sven Neumann  <sven@gimp.org>

	* tools/pdbgen/pdb/fileops.pdb (file_load_thumbnail): removed
	color cast.

	* app/pdb/fileops_cmds.c: regenerated.

2004-04-20  Sven Neumann  <sven@gimp.org>

	* plug-ins/common/iwarp.c (iwarp_get_pixel): check tile != NULL
	before unrefing it. Fixes bug #140554.

2004-04-19  Henrik Brix Andersen  <brix@gimp.org>

	* plug-ins/script-fu/scripts/gimp-headers.scm
	* plug-ins/script-fu/scripts/gimp-labels.scm: applied a patch from
	William Skaggs which changes the sub menu title for the gimp web
	theme to classic.gimp.org. Fixes bug #137036.

2004-04-18  Henrik Brix Andersen  <brix@gimp.org>

	* app/widgets/gimptemplateeditor.c
	(gimp_template_editor_constructor): use g_signal_connect_object()
	instead of g_signal_connect(). Fixes bug #140315.

2004-04-18  Pedro Gimeno  <pggimeno@wanadoo.es>

	* plug-ins/common/tga.c (load_image): Fix a condition which was
	preventing GRAYA images from loading.

2004-04-18  Sven Neumann  <sven@gimp.org>

	* plug-ins/print/gimp_main_window.c: replaced wrong use of
	gimp_option_menu with gimp_int_option_menu; merged from HEAD.

2004-04-17  Henrik Brix Andersen  <brix@gimp.org>

	* app/tools/gimphuesaturationtool.c
	(gimp_hue_saturation_tool_dialog): resolved conflicting
	mnemonic. Fixes bug #139868.

2004-04-17  Henrik Brix Andersen  <brix@gimp.org>

	* plug-ins/common/jpeg.c (save_dialog): live preview doesn't
	modify the undo history of the image anymore, label changed
	accordingly. Fixes bug #140296.

2004-04-16  Pedro Gimeno  <pggimeno@wanadoo.es>

	* plug-ins/common/tile.c (tile): changed a call to
	gimp_image_undo_enable to _undo_disable which was obviously the
	intention of the author. Added a call to gimp_drawable_update to
	get the previews refreshed.

2004-04-16  Sven Neumann  <sven@gimp.org>

	* app/tools/gimpcolorpickertool.c
	* app/tools/gimpmeasuretool.c: don't use gtk_window_present() to
	raise the tool dialog since it also moves the focus away from the
	image window. Fixes the problem described in bug #139349.

2004-04-16  Sven Neumann  <sven@gimp.org>

	* plug-ins/helpbrowser/dialog.c (browser_dialog_load): present the
	help browser window (merged from HEAD).

2004-04-15  Tor Lillqvist  <tml@iki.fi>

	* app/plug-in/plug-in-message.c (plug_in_handle_proc_install)
	* app/plug-in/plug-in-proc.h (struct _PlugInProcDef)
	* app/plug-in/plug-in-rc.c (plug_in_rc_write)
	* app/plug-in/plug-ins.c (plug_ins_init): Make PDB procedures
	(including their menu entries) installed during a plug-ins init()
	phase show up. Add a flag to PlugInProcDef that tells whether the
	proc was installed during the init() phase. Such procs aren't
	saved to the pluginrc. Move the code that initializes plug-ins
	that need initialization earlier, before the procs are added to
	the PDB and menus are built. Fixes bug #139969.

	* libgimpthumb/Makefile.am: For Win32, install gimpthumb.def, like
	the .def files of the other libgimp* libs.

	* app/Makefile.am (INCLUDES): Add PANGOFT2_CFLAGS.

	* gimp-zip.in: Put also libgimpthumb in the developer package.

2004-04-15  Sven Neumann  <sven@gimp.org>

	* app/paint-funcs/paint-funcs.h: fixed declaration of
	initial_region() (bug #140115).

2004-04-14  Sven Neumann  <sven@gimp.org>

	* plug-ins/common/film.c: fixed typo (bug #140039).

2004-04-14  Sven Neumann  <sven@gimp.org>

	* Made 2.0.1 release.

2004-04-13  Raphaël Quinet  <quinet@gamers.org>

	* plug-ins/common/mng.c (query, run): Workaround for bug #139947:
	do not register the plug-in for INDEXED* modes and do not declare
	that it can handle INDEXED images in gimp_export_image().  This
	forces a conversion to RGB instead of generating broken indexed
	images.  The generation of correct indexed MNG files is likely to
	require a newer release of libmng.
	(mng_data): Set default compression level to 9 instead of 6.

2004-04-13  Sven Neumann  <sven@gimp.org>

	* plug-ins/imagemap/imap_cern_parse.c
	* plug-ins/imagemap/imap_csim_parse.c
	* plug-ins/imagemap/imap_ncsa_parse.c: regenerated using GNU Bison
	version 1.875a. Fixes bug #139894.

2004-04-13  Sven Neumann  <sven@gimp.org>

	* tools/gimp-remote.c: reverted last change and go back to the
	solution using fork(). Hopefully fixes bug #139158 this time.

2004-04-13  Sven Neumann  <sven@gimp.org>

	* app/core/gimp-utils.[ch] (gimp_get_default_language): added a
	category parameter to make this function more flexible.

	* app/text/gimptext.c: changed accordingly.

	* app/widgets/gimphelp.c (gimp_help): localize the help pages
	according to the value of LC_MESSAGES. Fixes bug #139917.

2004-04-13  Michael Natterer  <mitch@gimp.org>

	Moved the calls to floating_sel_relax()/rigor() from various
	places to two single spots in the core where they are actually
	needed. Fixes bug #138356 (which was caused by the projection
	being triggered in the middle of changing the floating selection's
	size or the size of the drawable it is attached to). This commit
	effectively removes floating selection fiddling from the core's
	public API.

	* app/core/gimpdrawable.[ch] (gimp_drawable_has_floating_sel): new
	function which returns TRUE if there is a floating selection
	attached to the drawable.

	* app/core/gimpdrawable.c (gimp_drawable_translate)
	(gimp_drawable_set_tiles_full): if the drawable *has* a floating
	selection, relax/rigor it before/after modifying the drawable.

	* app/core/gimplayer.c (gimp_layer_translate)
	(gimp_layer_set_tiles): if the layer *is* the floating selection,
	relax/rigor it before/after modifying it.

	* app/core/gimpdrawable-transform.c
	* app/core/gimpimage-convert.c
	* app/core/gimpimage-crop.c
	* app/core/gimpimage-flip.c
	* app/core/gimpimage-resize.c
	* app/core/gimpimage-rotate.c
	* app/core/gimpimage-scale.c
	* app/gui/layers-commands.c
	* app/tools/gimpeditselectiontool.c
	* tools/pdbgen/pdb/layer.pdb: removed calls to
	floating_sel_rigor()/relax() all over the place. Also removed
	lots of undo groups which are obsolete now.

	* app/pdb/layer_cmds.c: regenerated.

2004-04-13  Sven Neumann  <sven@gimp.org>

	* plug-ins/imagemap/imap_file.c (do_file_error_dialog): convert
	the filename to UTF-8 before displaying it.

2004-04-13  Michael Natterer  <mitch@gimp.org>

	GimpItem undo group cleanup in preparation of fixing bug #138356:

	* app/core/core-enums.[ch]: renamed LAYER_SCALE and LAYER_RESIZE
	undo groups to ITEM_SCALE and ITEM_RESIZE.

	* app/core/gimpitem.[ch]: always push undo groups around
	GimpItem::translate(), scale(), resize(), flip(), rotate() and
	transform(). Added the resp. undo_desc strings to GimpItemClass.

	* app/core/gimpchannel.[ch]
	* app/core/gimpdrawable.[ch]
	* app/core/gimplayer.c: removed all undo groups from
	implementations of the above methods. Removed the undo_desc
	strings which were moved to GimpItemClass.

	* app/core/gimpimage-crop.c
	* app/core/gimpselection.c
	* app/gui/layers-commands.c
	* app/vectors/gimpvectors.c
	* tools/pdbgen/pdb/layer.pdb: changed accordingly.

	* app/pdb/layer_cmds.c: regenerated.

2004-04-12  Sven Neumann  <sven@gimp.org>

	* configure.in: cleaned up the check for Xmu. Include <gdk/gdkx.h>
	when testing for Xmu.h. Fixes bug #139803.

2004-04-12  Sven Neumann  <sven@gimp.org>

	* libgimpmath/Makefile.am: remove test-md5 on make clean.

2004-04-11  Manish Singh  <yosh@gimp.org>

	* plug-ins/pygimp/plug-ins/py-slice.py: When using a separate dir for
	images, actually prepend the dir to the img srcs in the html. Allow
	only horizontal or vertical guides in an image, do not require both.
	A bit smarter path handling. Addresses most of bug #138714.

2004-04-11  Hans Breuer  <hans@breuer.org>

	* app/makefile.msc : build sanity.obj
	  app/text/makefile.msc : gimptextundo.obj
	  app/widgets/makefile.msc : gimppatternfactoryview.obj

	* plug-ins/common/winclipboard.c : don't call 
	gimp_image_undo_enable() when it's not switched off. 
	Otherwise the undo history would be destroyed with
	Gimp-Core-CRITICAL **: file gimpimage.c: line 1579: assertion 
	`gimage->undo_freeze_count > 0' failed

2004-04-10  Sven Neumann  <sven@gimp.org>

	* app/tools/gimptexttool.c (gimp_text_tool_apply): push an undo
	group only when it's needed. This resurrects text undo compression
	that broke when bug #137767 got fixed.

2004-04-10  Sven Neumann  <sven@gimp.org>

	* docs/gimp-remote.1.in: updated example URL.

2004-04-10  Pedro Gimeno  <pggimeno@wanadoo.es>

	* app/core/gimpdrawable-transform.c
	(gimp_drawable_transform_tiles_affine): Applied patch from William
	Skaggs that addresses bug #120490.

	* app/sanity.c (sanity_check): Modified the message that reports
	an old version of Fontconfig in an attempt to make it more
	informative.

2004-04-10  Sven Neumann  <sven@gimp.org>

	* tools/gimp-remote.c (start_new_gimp): reverted the last change
	and did a different fix that involves closing the X display before
	starting gimp (bug #139158).

2004-04-09  Manish Singh  <yosh@gimp.org>

	* plug-ins/common/jpeg.c: Uglier workaround for bug #138357, since
	the previous one did break error handling. Fixes bug #139571.

2004-04-09  Henrik Brix Andersen  <brix@gimp.org>

	* README.i18n: s/14/20/ plus whitespace clean-up.

2004-04-08  Sven Neumann  <sven@gimp.org>

	* plug-ins/script-fu/siod-wrapper.c: applied a patch from Kevin
	Cozens that makes the Script-Fu PDB marshaller handle NULL
	strings. Some minor code cleanup. Fixes bug #139386.

2004-04-08  Sven Neumann  <sven@gimp.org>

	* tools/gimp-remote.c (start_new_gimp): applied a patch from
	Michael Matz that calls fork() before starting gimp. This is to
	avoid X server authentification problems (bug #139158).

2004-04-07  Henrik Brix Andersen  <brix@gimp.org>

	* configure.in (ALL_LINGUAS): revert addition of "is" until all
	.po files are there.

2004-04-07  Samúel Jón Gunnarsson  <sammi@techattack.nu>

	* configure.in: Added "is" to ALL_LINGUAS

2004-04-06  Iñaki Larrañaga  <dooteo@euskalgnu.org>

	* configure.in: Added "eu" (Basque) to ALL_LINGUAS.

2004-04-05  Pedro Gimeno  <pggimeno@wanadoo.es>

	* plug-ins/script-fu/scripts/copy-visible.scm: Use
	gimp-image-get-active-layer/channel instead of the passed
	drawable for later restoring the initially active layer/channel.
	Addresses bug #138662.

	* plug-ins/script-fu/scripts/drop-shadow.scm: Add a call to
	gimp-image-set-active-layer in order for it to fail early instead
	of failing with the undo group open in case the drawable is not
	suitable for applying the effect.

2004-04-05  Michael Natterer  <mitch@gimp.org>

	* app/core/gimpimage.c (gimp_image_real_mode_changed): update the
	whole image.

	* app/display/gimpdisplay-handlers.c: removed obsolete
	"mode_changed" and "colormap_changed" handlers because GimpImage's
	default handlers already update the whole image.

2004-04-05  Pedro Gimeno  <pggimeno@wanadoo.es>

	Sanitize rectangle and ellipse selection handling (bug #138237
	and bug #138103):

	* app/tools/gimprectselecttool.h
	* app/tools/gimprectselecttool.c (GimpRectSelectTool): new
	member "moved" indicating whether the cursor was moved after
	the click.
	(gimp_rect_select_tool_coords_to_integer): New function for
	consistent conversion of the rectangle FP coords to pixels.
	(gimp_rect_select_tool_button_press,
	gimp_rect_select_tool_button_release,
	gimp_rect_select_tool_motion, gimp_rect_select_tool_draw): use
	it instead of fiddling with the FP coordinates. Update "moved"
	and use it to detect whether the selection needs to be cleared.

	* app/tools/gimpellipseselecttool.c
	(gimp_ellipse_select_tool_draw): use the new coords_to_integer
	function.

2004-04-05  Sven Neumann  <sven@gimp.org>

	* plug-ins/Lighting/lighting_ui.c: applied the second patch
	attached to bug #138788 by William Skaggs. Removes some user
	interface elements that have no corresponding implementation and
	fixes preview updates.

2004-04-04  Sven Neumann  <sven@gimp.org>

	* Makefile.am
	* NEWS.pre-2-0: moved old NEWS to this new file.

	* NEWS: list bugs fixed since 2.0.0.

2004-04-04  Sven Neumann  <sven@gimp.org>

	* Makefile.am
	* docs/Makefile.am: don't install gimptool symlinks to
	gimptool-2.0 and its manpage. gimp.m4 as installed with gimp-1.2
	looks for gimptool (bug #139024).

2004-04-04  Sven Neumann  <sven@gimp.org>

	* app/display/gimpdisplayshell-callbacks.c
	* app/display/gimpdisplayshell-draw.[ch] pass the bounding box of
	the exposed area to gimp_display_shell_draw_grid() and draw only
	the relevant part of the grid. Fixes bug #138081.

2004-04-04  Sven Neumann  <sven@gimp.org>

	Cache the GC for drawing the grid as suggested in bug #138081:

	* app/display/gimpdisplayshell.[ch]: added a grid_gc member to
	GimpDisplayShell.

	* app/display/gimpdisplayshell-handlers.c
	(gimp_display_shell_grid_notify_handler)
	(gimp_display_shell_disconnect): invalidate the grid GC.

	* app/display/gimpdisplayshell-draw.c (gimp_display_shell_draw_grid):
	use the cached grid_gc. Also applied the fix that Pedro Gimeno did
	for bug #138606.

2004-04-04  Sven Neumann  <sven@gimp.org>

	* app/core/gimpundo.c (gimp_undo_type_to_name): added a missing
	call to gettext(). Fixes bug #139000.

2004-04-03  Manish Singh  <yosh@gimp.org>

	* gimptool-2.0.in: Create any directories in the install path that do
	not already exist. Fixes bug #138980.

	* docs/gimptool.1.in: s/dont/don't/g

2004-04-04  Sven Neumann  <sven@gimp.org>

	* app/core/gimpimagemap.c (gimp_image_map_apply): do nothing if the
	selection is empty. Fixes bug #138973.

2004-04-03  Sven Neumann  <sven@gimp.org>

	* app/text/gimptextlayer.c (gimp_text_layer_new): create the
	initial text layer with a size of 1 x 1 since tile_manager_new()
	does not any longer accept 0 x 0.

	* app/core/gimpdrawable.c (gimp_drawable_configure): check that
	width and height are > 0.

2004-04-03  Sven Neumann  <sven@gimp.org>

	* plug-ins/Lighting/lighting_main.c
	* plug-ins/Lighting/lighting_shade.c: applied the first of two
	patches attached to bug #138788 by William Skaggs.

2004-04-02  Simon Budig  <simon@gimp.org>

	* plug-ins/common/whirlpinch.c: set a proper pixelfetcher 
	edge mode for bigger radii. Avoids getting garbage at the
	image borders.

2004-04-02  Dave Neary  <bolsh@gimp.org>

	* plug-ins/common/jpeg.c: Added .jpe to the list of extensions 
	that the jpeg plug-in recognises. Fixes bug #138776.

2004-04-01  Sven Neumann  <sven@gimp.org>

	* app/gui/user-install-dialog.c: unset the bg_pixmap and tweak
	style colors for all states. Sort of ugly but makes the dialog
	work better with more obscure themes (bug #138379).

2004-04-01  Sven Neumann  <sven@gimp.org>

	* tools/kernelgen.c: updated a comment.

2004-04-01  Michael Natterer  <mitch@gimp.org>

	* app/core/core-enums.[ch] (enum GimpUndoType): added undo type
	GIMP_UNDO_TEXT_LAYER_MODIFIED and undo group types
	GIMP_UNDO_GROUP_DRAWABLE and GIMP_UNDO_GROUP_DRAWABLE_MOD.

	* app/core/gimpimage-undo-push.[ch]: added new new function
	gimp_image_undo_push_text_layer_modified() which makes
	modifications of the text_layer's "modified" boolean undoable.

	* app/core/gimpdrawable.[ch]: added new virtual function
	GimpDrawable::push_undo() and moved the actual undo pushing into
	the default implementation gimp_drawable_real_push_undo().

	* app/text/gimptextlayer.c (gimp_text_layer_push_undo): new
	function. Pushes the text_layer's modified state to the undo stack
	after upchaining and sets modified to TRUE.

	(gimp_text_layer_set_tiles): ditto.

	(gimp_lext_layer_apply_region)
	(gimp_text_layer_replace_region): removed because their default
	implementations already call gimp_drawable_push_undo().

	(gimp_text_layer_swap_pixels): removed because swap_pixels() is
	used by undo only and doesn't need to care about the text_layer's
	modified state.

	(gimp_text_layer_render): don't set modified to FALSE here because
	we can't push an undo step here.

	(gimp_text_layer_set): push the modified state to the undo stack
	and set it to FALSE here. Also push the layer's tiles if the
	layer was modified.

	* app/tools/gimptexttool.c (gimp_text_tool_apply): push "modified"
	to the undo stack and set it to FALSE here, too.

	Fixes bug #137767.

2004-03-31  Simon Budig  <simon@gimp.org>

	* app/tools/gimptransformtool.c: One really should use braces
	when mixing additions and multiplication and the operator
	precedence is not the desired one...

	I feel stupid...  :-)

2004-03-31  Michael Natterer  <mitch@gimp.org>

	* app/core/gimp-transform-utils.c
	(gimp_transform_matrix_perspective): make sure 0.0/0.0 results
	in 1.0, not NaN.

	* app/core/gimpdrawable-transform.c
	(gimp_drawable_transform_tiles_affine): instead of returning NULL
	if the transformation shrinks the tiles completely away, return at
	least the pixel (or the row or column of pixels) which best covers
	the sub-pixel area of the transform result:

	- Changed rounding of the transformed coordinates from RINT()
	  to floor()/ceil() so we don't cut off sub-pixel portions of the
	  transform result.
	- Force the minimal size if the changed rounding didn't help.

	Fixes bug #138117.

	Also added paranoia code which falls back to clip_result if the
	passed matrix produces NaN coordinates (copied the FINITE() macro
	from image_cmds.c).

2004-03-30  Sven Neumann  <sven@gimp.org>

	* plug-ins/script-fu/scripts/grid-system.scm: define "map" here,
	the script used to take the definition from alien-glow-arrow.scm
	or beveled-pattern-arrow.scm. Also added an undo group around all
	operations. Fixes bug #138524.

2004-03-30  Michael Natterer  <mitch@gimp.org>

	* app/Makefile.am
	* app/sanity.[ch]: new files implementing sanity_check() for
	run-time checking library versions. Added a check for FreeType but
	disabled it until we figured if and how freetype causes some of
	the DLL hell bugs.

	* app/main.c (main): call it and abort if it fails.

	* app/app_procs.[ch]: added app_gui_abort() so main.c doesn't
	need to #include "gui/gui.h"

	* app/gui/gui.[ch] (gui_libs_init): removed library sanity checking.

	(gui_abort): new function which shows the abort message.

2004-03-30  Michael Natterer  <mitch@gimp.org>

	* configure.in (ALL_LINGUAS): revert addition of "pa" until
	all .po files are there.

2004-03-20  Guntupalli Karunakar  <karunakar@freedomink.org>

	* configure.in: Added "pa" for Punjabi to ALL_LINGUAS.

2004-03-29  Manish Singh  <yosh@gimp.org>

	* plug-ins/common/jpeg.c (struct my_error_mgr): Move setjump_buffer
	to the beginning of the structure, to make sure it is aligned on a
	16-byte boundary for ia64, even with icc. Fixes #138357.

2004-03-29  Sven Neumann  <sven@gimp.org>

	* app/config/gimpguiconfig.c: changed the default for "help-locales"
	from NULL to an empty string. Fixes the generated gimprc man-page.

	* app/config/gimprc-blurbs.h (HELP_LOCALES_BLURB): added missing
	whitespace.

	* app/widgets/gimphelp.c: use the user's locale if "help-locales"
	is NULL or the empty string.

	* docs/gimprc.5.in
	* etc/gimprc: regenerated.

2004-03-29  Michael Natterer  <mitch@gimp.org>

	* app/core/core-enums.[ch] (enum GimpUndoType): added new group
	GIMP_UNDO_GROUP_FS_REMOVE.

	* app/core/gimplayer-floating-sel.c (floating_sel_remove): push an
	undo group. Fixes undo corruption spotted by Pedro Gimeno.

2004-03-29  Michael Natterer  <mitch@gimp.org>

	* plug-ins/common/guillotine.c (guillotine): Don't just skip
	guides at the image edges but any guide which is at a position we
	already remembered. Should catch all instances of bug #138312 this
	time.

2004-03-28  Sven Neumann  <sven@gimp.org>

	* plug-ins/ifscompose/ifscompose.c: applied patch from David Necas
	that updates the sensitivity of the Delete button and menu entry.
	Fixes bug #138212.

2004-03-28  Sven Neumann  <sven@gimp.org>

	* plug-ins/MapObject/mapobject_main.c: fixed non-interactive call.

	* plug-ins/script-fu/scripts/spinning-globe.scm: pass -1 as
	drawable ID for unused drawables. Fixes bug #138253.
	
2004-03-28  Sven Neumann  <sven@gimp.org>

	* app/text/gimpfontlist.c (gimp_font_list_add_font): validate the
	font name. This should work around the crashes that Windows users
	were experiencing on startup (bug #132366). The real problem needs
	to be fixed elsewhere though.

2004-03-28  Michael Natterer  <mitch@gimp.org>

	* app/core/gimpimage-undo-push.c (undo_pop_layer): when re-adding
	a layer with mask, don't forget to set layer->mask->removed to FALSE.

2004-03-28  Michael Natterer  <mitch@gimp.org>

	* app/core/gimpitem.[ch]: added "gboolean removed" to the GimpItem
	struct. Defaults to FALSE. Set it to TRUE in gimp_item_removed().
	Added public function gimp_item_is_removed().

	* app/core/gimpimage-undo-push.c (undo_pop_layer)
	(undo_pop_layer_mask) (undo_pop_channel) (undo_pop_vectors):
	set it to FALSE manually when re-adding something from the
	undo stack.

	* tools/pdbgen/app.pl
	* tools/pdbgen/pdb.pl: don't allow any operation on items which
	are removed from the image (and exist on the undo stack only).
	Fixes bug #138311.

	* app/pdb/channel_cmds.c
	* app/pdb/color_cmds.c
	* app/pdb/drawable_cmds.c
	* app/pdb/edit_cmds.c
	* app/pdb/floating_sel_cmds.c
	* app/pdb/image_cmds.c
	* app/pdb/layer_cmds.c
	* app/pdb/paint_tools_cmds.c
	* app/pdb/parasite_cmds.c
	* app/pdb/selection_cmds.c
	* app/pdb/selection_tools_cmds.c
	* app/pdb/transform_tools_cmds.c: regenerated.

2004-03-28  Sven Neumann  <sven@gimp.org>

	* plug-ins/script-fu/scripts/slide.scm: applied a (modified) patch
	from Nils Philippsen that fixes bug #138310.

2004-03-28  Michael Natterer  <mitch@gimp.org>

	* plug-ins/common/guillotine.c (guillotine): applied a (modified)
	patch from Joao S. O. Bueno which removes any guides from the
	cropped images. Fixes bug #138314.

	Skip guides which are at the image's edges because the algorithm
	already assumes that there are always guides at these positions.
	Fixes bug #138312.

2004-03-27  Tor Lillqvist  <tml@iki.fi>

	* plug-ins/help/Makefile.am (AM_LDFLAGS): Use -mwindows on Windows
	to avoid a console window popping up.

2004-03-26  Manish Singh  <yosh@gimp.org>

	* tools/pdbgen/app.pl: don't generate code with tabs.

	* tools/pdbgen/pdb/procedural_db.pdb: convert tabs to spaces in
	helper function declaration.

	* app/pdb/procedural_db.c: convert tabs to spaces.

	* app/pdb/*.c: regenerated, no code changes, only tabs->spaces.

2004-03-26  Manish Singh  <yosh@gimp.org>

	* tools/pdbgen/app.pl: kill whitespace in blank lines.

	* app/pdb/*.c: regenerated, no code changes, only whitespace.

2004-03-26  Michael Natterer  <mitch@gimp.org>

	* app/core/gimpdrawable-transform.c
	(gimp_drawable_transform_tiles_affine): return NULL tiles if the
	matrix would transform the drawable into nothing. Fixes the
	core-crashing part of bug #138117 and makes the script fail
	with an execution error.

2004-03-25  Sven Neumann  <sven@gimp.org>

	* README: mention the gimp-perl pre-release and provide a link.

2004-03-25  Michael Natterer  <mitch@gimp.org>

	* app/base/tile-manager.c (tile_manager_new): g_return_if_fail()
	on width, height or bpp <= 0. Doesn't fix anything but badly
	warns (and helps debugging) on bug #138117.

2004-03-25  Michael Natterer  <mitch@gimp.org>

	* app/tools/gimpvectortool.c (gimp_vector_tool_button_release):
	fixed condition which triggers the path tool's undo hack.  Fixes
	bug #138086. Also g_object_unref() the undo step.

	Removed trailing whitespace.

2004-03-25  Manish Singh  <yosh@gimp.org>

	* libgimp/gimp.c
	* app/plug-in/plug-in-shm.c: close the shm_open fd in the POSIX
	shm case. We were leaking an fd here.

	* app/tools/gimptexttool.c (gimp_text_tool_connect): remove
	unnecessary G_OBJECT() cast in g_object_set() call.

2004-03-23  Michael Natterer  <mitch@gimp.org>

	* autogen.sh: be verbose about AUTOGEN_CONFIGURE_ARGS in the
	message that is printed if no arguments were passed.

2004-03-23  Sven Neumann  <sven@gimp.org>
	    Michael Natterer <mitch@gimp.org>

	* Made 2.0.0 release.
